# 细节

## 接口

在与红石信号交互之前必须要将红石输入输出抽象为接口。接口是一排特殊的标靶方块（或者一个标靶方块也行），可以通过魔杖物品和指令在游戏内创建或通过代码在游戏外创建。接口可以用这些特殊标靶方块来接受或发出红石信号，同时将相应的数据通过模组传递给外部程序。

## 外部程序

外部程序可以用来读写接口并响应事件（如游戏刻、数据变化、被其他外部程序调用）。

外部程序相关文档参见 [docs/Scripts.zh_cn.md](./docs/Scripts.zh_cn.md)。

## 命令

所有由模组提供的命令的权限等级都至少为 2（可配置）。特殊地，命令 `/rcu run` 的权限等级可能更高，由外部程序决定。这意味着命令方块可能无法运行它。所有命令都可以使用 `/execute as` 来改变执行者身份。

`/rcu`
- 给予命令执行者一个魔杖物品（可配置，默认为粉红色染料）。

`/rcu new <接口名> [选项...]`
- 创建接口。接口名**必须**在所有接口中唯一且**必须**只由字母、数字和下划线组成。

`/rcu remove <接口名...>`
- 删除接口。

`/rcu info`
- 显示接口和外部程序信息。

`/rcu info interface`
- 显示接口信息。

`/rcu info interface <接口名...>`
- 显示指定接口详情。

`/rcu info script`
- 显示外部程序信息。

`/rcu info script <外部程序名...>`
- 显示指定外部程序详情。

`/rcu run <外部程序名> [参数...]`（待开发）
- 使用指定的参数运行外部程序。参数可以是接口名、外部程序名或其他任意字符串。

`/rcu reload`（待开发）
- 重新加载所有外部程序。

`/rcu lang`
- 显示命令执行者的当前显示语言。

`/rcu lang <语言>`
- 设置命令执行者的显示语言。

## 性能

在 `AMD Ryzen 7 4800U` CPU 上运行的 Kubuntu `22.04.1 LTS x86_64`（Kernel `5.15.0-46-lowlatency`）上运行的 Minecraft 1.19.2 服务器上测试时，一次空事件回调消耗约 0.27ms，一次空 API 调用消耗约 0.12ms。原始测试结果如下：

|                                                             | tps  | mspt |
| ----------------------------------------------------------- | ---- | ---- |
| 未安装模组                                                  | 1382 | 0.72 |
| 无外部程序                                                  | 1383 | 0.72 |
| onGametickStart 事件回调，无 API 调用                       | 1013 | 0.99 |
| onGametickStart 事件回调，每次事件回调时进行 1 次 API 调用  | 929  | 1.08 |
| onGametickStart 事件回调，每次事件回调时进行 10 次 API 调用 | 458  | 2.18 |

测试使用 carpet 模组命令 `/tick warp 100000` 和外部程序 `example/nop_api_*.py`，无玩家登录。
